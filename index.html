<!DOCTYPE html>
<html>
<head>
<title>Readable JavaScript</title>
<script type="text/javascript">
window.addEventListener('load', function () {
    var storage = widget.preferences;

    function onConnectHandler(event) {
        if (event && event.origin && event.origin.indexOf('widget://') == -1) {
            var tab = opera.extension.tabs.getFocused();
            if (tab) tab.postMessage({type: 'readable-javascript', options: JSON.stringify(storage)});
        }
    }

    if (storage['enable_button'] === 'true') {
        var theButton;
        var toolbarUIItemProperties = {
            title: 'Readable JavaScript',
            icon: 'icons/icon16.png',
            popup: {
                href: 'popup.html',
                width: 600,
                height: 400
            }
        }
        theButton = opera.contexts.toolbar.createItem(toolbarUIItemProperties);
        opera.contexts.toolbar.addItem(theButton);
        opera.extension.onconnect = onConnectHandler;
    }
}, false);
</script>
</head>
</html>
